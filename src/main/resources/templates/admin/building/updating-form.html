<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>AdminLTE 3 | Dashboard</title>

    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
          rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}">

    <!-- Ionicons -->
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">

    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">

    <!-- iCheck -->
    <link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">

    <!-- JQVMap -->
    <link rel="stylesheet" th:href="@{/plugins/jqvmap/jqvmap.min.css}">

    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">

    <!-- overlayScrollbars -->
    <link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">

    <!-- Daterange picker -->
    <link rel="stylesheet" th:href="@{/plugins/daterangepicker/daterangepicker.css}">

    <!-- summernote -->
    <link rel="stylesheet" th:href="@{/plugins/summernote/summernote-bs4.min.css}">

    <!-- Toastr -->
    <link rel="stylesheet" th:href="@{plugins/toastr/toastr.min.css}">
</head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
        <img alt="AdminLTELogo" class="animation__shake" height="60" src="dist/img/AdminLTELogo.png" width="60">
    </div>

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a class="nav-link" href="#">HOME PAGE</a>
            </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
            <!-- Navbar Search -->
            <li class="nav-item">
                <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                    <i class="fas fa-search"></i>
                </a>
                <div class="navbar-search-block">
                    <form class="form-inline">
                        <div class="input-group input-group-sm">
                            <input aria-label="Search" class="form-control form-control-navbar" placeholder="Search"
                                   type="search">
                            <div class="input-group-append">
                                <button class="btn btn-navbar btn" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                                <button class="btn btn-navbar" data-widget="navbar-search" type="button">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                    <i class="fas fa-expand-arrows-alt"></i>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-controlsidebar-slide="true" data-widget="control-sidebar" href="#"
                   role="button">
                    <i class="fas fa-th-large"></i>
                </a>
            </li>
        </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img alt="User Image" class="img-circle elevation-2" src="dist/img/user2-160x160.jpg">
                </div>
                <div class="info">
                    <a class="d-block" href="#">Alexander Pierce</a>
                </div>
            </div>

            <!-- SidebarSearch Form -->
            <div class="form-inline">
                <div class="input-group" data-widget="sidebar-search">
                    <input aria-label="Search" class="form-control form-control-sidebar" placeholder="Search"
                           type="search">
                    <div class="input-group-append">
                        <button class="btn btn-sidebar">
                            <i class="fas fa-search fa-fw"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-accordion="false" data-widget="treeview"
                    role="menu">
                    <!-- Add icons to the links using the .nav-icon class
                         with font-awesome or any other icon font library -->
                    <li class="nav-item menu-open">
                        <a class="nav-link active" href="#">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Dashboard
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Dashboard v1</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--Building management-->
                    <li class="nav-item menu-open">
                        <a class="nav-link active" href="#">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Building Management
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin/search-building}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Search Building</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin/update-building}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Update Building</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--End Building management-->
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">Dashboard</h1>
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Dashboard v1</li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <section class="content">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"
                                        th:text="${buildingUpdateDTO.id == null}? 'Save Building' : 'Update Building'"></h3>
                                </div>
                                <!-- /.card-header -->
                                <form action="/admin/building" id="buildingUpdatingForm"
                                      method="POST" th:object="${buildingUpdateDTO}">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2"
                                                 th:style="${buildingUpdateDTO.id == null} ? 'display: none;' : 'display: inline' ">
                                                <div class="form-group">
                                                    <label for="buildingId">Id tòa nhà</label>
                                                    <input class="form-control" id="buildingId" name="name" readonly
                                                           th:field="*{id}" type="text"/>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="buildingName">Tên tòa nhà</label>
                                                    <input class="form-control" id="buildingName" name="name"
                                                           placeholder="Nhập tên tòa nhà" required th:field="*{name}"
                                                           type="text"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="district">Quận</label>
                                                    <select class="form-control" id="district" name="district"
                                                            required th:field="*{district}">
                                                        <option value="">---Chọn Quận---</option>
                                                        <option th:each="districtItem : ${districtMappings}"
                                                                th:text="${districtItem.value}"
                                                                th:value="${districtItem.key}"
                                                        ></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-5">
                                                <label for="buildingWard">Phường</label>
                                                <input class="form-control" id="buildingWard" name="ward" th:field="*{ward}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-5">
                                                <label for="buildingStreet">Đường</label>
                                                <input class="form-control" id="buildingStreet" name="street"
                                                       th:field="*{street}" type="text"/>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <label for="numberOfBasement">Số tầng hầm</label>
                                                <input class="form-control" id="numberOfBasement" name="number_of_basement"
                                                       th:field="*{numberOfBasement}" type="number"/>
                                            </div>
                                            <div class="col-sm-3">
                                                <label for="direction">Hướng</label>
                                                <input class="form-control" id="direction" name="direction" th:field="*{direction}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-sm-3">
                                                <label for="level">Hạng</label>
                                                <input class="form-control" id="level" name="level" th:field="*{level}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-sm-3">
                                                <label for="structure">Cấu trúc</label>
                                                <input class="form-control" id="structure" name="structure" th:field="*{structure}"
                                                       type="text"/>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="rentAreas">Diện tích thuê</label>
                                                <input class="form-control" id="rentAreas" name="rent_areas" required
                                                       th:field="*{rentAreas}" type="text"/>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="floorArea">Diện tích sàn</label>
                                                    <input class="form-control" id="floorArea" name="floor_area"
                                                           th:field="*{floorArea}" type="number"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="managerName">Tên quản lí</label>
                                                <input class="form-control" id="managerName" name="manager_name"
                                                       th:field="*{managerName}" type="text"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="managerPhoneNumber">SĐT quản lí</label>
                                                <input class="form-control" id="managerPhoneNumber" name="manager_phone_number"
                                                       th:field="*{managerPhone}" type="text"/>
                                            </div>
                                            <div class="col-md-3">
                                                <tr th:each="rentType : ${rentTypeMappings}">
                                                    <td>
                                                        <label for="rentType-${rentType.key}"
                                                               th:text="${rentType.value}"></label>
                                                        <input id="rentType-${rentType.key}" name="type" th:checked="${buildingUpdateDTO.type != null && buildingUpdateDTO.type.contains(rentType.key)}"
                                                               th:value="${rentType.key}"
                                                               type="checkbox"/>
                                                    </td>
                                                </tr>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2">
                                                <label for="rentPrice">Giá thuê</label>
                                                <input class="form-control" id="rentPrice" name="rent_price"
                                                       required th:field="*{rentPrice}" type="number"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="rentPriceDesription">Mô tả giá thuê</label>
                                                <input class="form-control" id="rentPriceDesription" name="rent_price_description"
                                                       th:field="*{rentPriceDescription}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="serviceFee">Phí dịch vụ</label>
                                                <input class="form-control" id="serviceFee" name="service_fee"
                                                       th:field="*{serviceFee}" type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="carFee">Phí ô tô</label>
                                                <input class="form-control" id="carFee" name="car_fee" th:field="*{carFee}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="motorbikeFee">Phí xe máy</label>
                                                <input class="form-control" id="motorbikeFee" name="motorbike_fee"
                                                       th:field="*{motorbikeFee}" type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="overtimeFee">Phí ngoài giờ</label>
                                                <input class="form-control" id="overtimeFee" name="overtime_fee"
                                                       th:field="*{overtimeFee}" type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="waterFee">Tiền nước</label>
                                                <input class="form-control" id="waterFee" name="water_fee" th:field="*{waterFee}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="electricityFee">Tiền điện</label>
                                                <input class="form-control" id="electricityFee" name="electricity_fee"
                                                       th:field="*{electricityFee}" type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="brokerageFee">Phí môi giới</label>
                                                <input class="form-control" id="brokerageFee" name="brokerage_fee"
                                                       th:field="*{brokerageFee}" type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="deposit">Đặt cọc</label>
                                                <input class="form-control" id="deposit" name="deposit" th:field="*{deposit}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="payment">Thanh toán</label>
                                                <input class="form-control" id="payment" name="payment" th:field="*{payment}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="rentTime">Thời gian thuê</label>
                                                <input class="form-control" id="rentTime" name="rent_time" th:field="*{rentTime}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="decoration_time">Thời gian trang trí</label>
                                                <input class="form-control" id="decoration_time" name="decoration_time"
                                                       th:field="*{decorationTime}" type="text"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label for="note">Ghi chú</label>
                                                <input class="form-control" id="note" name="note" th:field="*{note}"
                                                       type="text"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="buildingImage">Ảnh tòa nhà </label>
                                        <div class="input-group">
                                            <div class="custom-file">
                                                <label class="custom-file-label" for="buildingImage">Choose file</label>
                                                <input accept="image/*" class="custom-file-input" id="buildingImage"
                                                       type="file">
                                            </div>
                                        </div>
                                        <img alt="nothing" class="img-fluid img-thumbnail" height="500" id="uploadedBuildingImage"
                                             src="#" style="display: none;" width="500">
                                    </div>
                                    <!-- /.card-body -->
                                    <div class="card-footer">
                                        <button class="btn btn-success toastrDefaultSuccess" id="buildingEditSubmitButton"
                                                type="submit">Submit
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <!-- /.card-body -->
                            <!-- /.card -->
                        </section>
                    </div>
                </div><!-- /.container-fluid -->
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
        All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
            <b>Version</b> 3.2.0
        </div>
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script th:inline="javascript">
    //<![CDATA[
    $(document).ready(function () {
        $.widget.bridge('uibutton', $.ui.button);
    });
    //]]>
</script>
<!-- Bootstrap 4 -->
<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- ChartJS -->
<script th:src="@{/plugins/chart.js/Chart.min.js}"></script>
<!-- Sparkline -->
<script th:src="@{/plugins/sparklines/sparkline.js}"></script>
<!-- JQVMap -->
<script th:src="@{/plugins/jqvmap/jquery.vmap.min.js}"></script>
<script th:src="@{/plugins/jqvmap/maps/jquery.vmap.usa.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
<!-- daterangepicker -->
<script th:src="@{/plugins/moment/moment.min.js}"></script>
<script th:src="@{/plugins/daterangepicker/daterangepicker.js}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script th:src="@{/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js}"></script>
<!-- Summernote -->
<script th:src="@{/plugins/summernote/summernote-bs4.min.js}"></script>
<!-- overlayScrollbars -->
<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/dist/js/adminlte.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/dist/js/demo.js}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script th:src="@{/dist/js/pages/dashboard.js}"></script>
<!-- bs-custom-file-input -->
<script th:src="@{/plugins/bs-custom-file-input/bs-custom-file-input.min.js}"></script>

<script>
    $(function () {
        bsCustomFileInput.init();
    });
</script>


<script th:inline="Javascript">
    const buildingImageDOM = document.getElementById("buildingImage");
    // Add event listener for input change
    buildingImageDOM.addEventListener("change", function () {
        var files = this.files;
        if (files.length > 0) {
            // Assuming you want to show the first selected image
            var selectedFile = files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                // Get the data URL of the selected image
                var imageDataURL = e.target.result;
                // Display the uploaded image
                var uploadedImage = document.getElementById("uploadedBuildingImage");
                uploadedImage.src = imageDataURL;
                uploadedImage.style.display = "block"; // Show the image
            };
            reader.readAsDataURL(selectedFile);
        }
    });
</script>
<script th:inline="Javascript">
    $('#buildingUpdatingForm').submit(function (event) {
        event.preventDefault(); // Prevent the default form submission

        var formData = $(this).serializeArray(); // Serialize the form data as an array
        // console.log(formData)
        var jsonData = {}; // Create an empty object to store JSON data
        // Sử dụng hàm reduce để xử lý formData và tạo đối tượng JSON
        formData.reduce(function (acc, current) {
            // Kiểm tra xem trường dữ liệu có tên và không phải là "_rentTypeCodes" không
            if (current.name !== undefined) {
                if (current.name === "type") {
                    if (!Array.isArray(acc[current.name])) {
                        acc[current.name] = [current.value];
                    } else {
                        acc[current.name].push(current.value);
                    }
                } else if (current.name === "rentAreas") {
                    acc[current.name] = current.value.split(',');
                } else {
                    acc[current.name] = current.value;
                }
            }
            return acc;
        }, jsonData);
        if (jsonData.type !== undefined) {
            var typeArr = jsonData.type;
            jsonData.type = typeArr.join(",");
        }
        console.log(jsonData);
        // Convert JSON object to JSON string
        var jsonString = JSON.stringify(jsonData);
        var url = '/admin/building' + ([[${buildingUpdateDTO.id}]] == null ? '' : '/' + [[${buildingUpdateDTO.id}]]);
        $.ajax({
            url: url, // URL to submit the form data
            type: 'POST',
            contentType: 'application/json', // Set content type to JSON
            data: jsonString, // Send JSON string as data
            success: function (response) {

                //send image data to server
                var formData = new FormData();
                var file = $('#buildingImage')[0].files[0];
                formData.append('file', file);
                $.ajax({
                    url: '/api/attachment/image/building/' + [[${buildingUpdateDTO.id}]], // URL to submit the form data
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                    },
                    error: function (xhr, status, error) {
                    }
                });
                alertBuildingEditSuccess();
                window.location.href = "/admin/search-building"
                console.log('Form submitted successfully');
            },
            error: function (xhr, status, error) {
                alertBuildingEditError();
                console.error('Form submission failed:', error);
            }
        });
    });
    const alertBuildingEditSuccess = function () {
        var Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 4000
        });
        Toast.fire({
            icon: 'success',
            title: 'Sửa tòa nhà thành công'
        })
    }
    const alertBuildingEditError = function () {
        var Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 4000
        });
        Toast.fire({
            icon: 'error',
            title: 'Lỗi khi sửa tòa nhà'
        })
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
