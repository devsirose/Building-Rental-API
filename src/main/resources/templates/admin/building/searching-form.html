<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>AdminLTE 3 | Dashboard</title>

    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
          rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" th:href="@{/plugins/fontawesome-free/css/all.min.css}">

    <!-- Ionicons -->
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">

    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">

    <!-- iCheck -->
    <link rel="stylesheet" th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">

    <!-- JQVMap -->
    <link rel="stylesheet" th:href="@{/plugins/jqvmap/jqvmap.min.css}">

    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">

    <!-- Link to AdminLTE CSS file -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.css}">

    <!-- overlayScrollbars -->
    <link rel="stylesheet" th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">

    <!-- Daterange picker -->
    <link rel="stylesheet" th:href="@{/plugins/daterangepicker/daterangepicker.css}">

    <!-- summernote -->
    <link rel="stylesheet" th:href="@{/plugins/summernote/summernote-bs4.min.css}">

    <!-- jsGrid -->
    <link rel="stylesheet" th:href="@{/plugins/jsgrid/jsgrid.min.css}">
    <link rel="stylesheet" th:href="@{/plugins/jsgrid/jsgrid-theme.min.css}">

    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
</head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
        <img alt="AdminLTELogo" class="animation__shake" height="60" src="dist/img/AdminLTELogo.png" width="60">
    </div>

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a class="nav-link" href="#">HOME PAGE</a>
            </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
            <!-- Navbar Search -->
            <li class="nav-item">
                <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                    <i class="fas fa-search"></i>
                </a>
                <div class="navbar-search-block">
                    <form class="form-inline">
                        <div class="input-group input-group-sm">
                            <input aria-label="Search" class="form-control form-control-navbar" placeholder="Search"
                                   type="search">
                            <div class="input-group-append">
                                <button class="btn btn-navbar" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                                <button class="btn btn-navbar" data-widget="navbar-search" type="button">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                    <i class="fas fa-expand-arrows-alt"></i>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-controlsidebar-slide="true" data-widget="control-sidebar" href="#"
                   role="button">
                    <i class="fas fa-th-large"></i>
                </a>
            </li>
        </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img alt="User Image" class="img-circle elevation-2" src="dist/img/user2-160x160.jpg">
                </div>
                <div class="info">
                    <a class="d-block" href="#">Alexander Pierce</a>
                </div>
            </div>

            <!-- SidebarSearch Form -->
            <div class="form-inline">
                <div class="input-group" data-widget="sidebar-search">
                    <input aria-label="Search" class="form-control form-control-sidebar" placeholder="Search"
                           type="search">
                    <div class="input-group-append">
                        <button class="btn btn-sidebar">
                            <i class="fas fa-search fa-fw"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-accordion="false" data-widget="treeview"
                    role="menu">
                    <!-- Add icons to the links using the .nav-icon class
                         with font-awesome or any other icon font library -->
                    <li class="nav-item menu-open">
                        <a class="nav-link active" href="#">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Dashboard
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Dashboard v1</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--Building management-->
                    <li class="nav-item menu-open">
                        <a class="nav-link active" href="#">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>
                                Building Management
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin/search-building}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Search Building</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" th:href="@{~/admin/update-building}">
                                    <i class="far fa-circle nav-icon"></i>
                                    <p>Update Building</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--End Building management-->
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">Dashboard</h1>
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Dashboard v1</li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <section class="content">

            <div class="modal fade" id="modal-default">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Giao tòa nhà cho nhân viên</h4>
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div th:each="staff : ${staffMappings}">
                                <label for="${'staffId-' + staff.key}" th:text="${staff.value}"></label>
                                <input class="staffCheckbox" id="${'staffId-' + staff.key}" th:name="staffId"
                                       th:value="${staff.key}" type="checkbox">
                            </div>
                        </div>
                        <div class="modal-footer justify-content-between">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                            <button class="btn btn-primary" id="assignBuildingButton" type="button">Save changes
                            </button>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
            </div>

            <!-- /.modal -->

            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <section class="content">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Search Building</h3>
                                </div>
                                <!-- form start -->
                                <form action="/admin/building" id="buildingSearchingForm"
                                      method="GET" th:object="${buildingSearchDTO}">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="buildingName">Tên tòa nhà</label>
                                                <input class="form-control" id="buildingName" name="buildingName"
                                                       placeholder="Nhập tên tòa nhà" th:field="*{name}"
                                                       type="text"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="floorArea">Diện tích sàn</label>
                                                <input class="form-control" id="floorArea" name="floorArea"
                                                       th:field="*{floorArea}" type="number"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="district">Quận</label>
                                                    <select class="form-control" id="district" name="district"
                                                            th:field="*{district}">
                                                        <option value="">---Chọn Quận---</option>
                                                        <option th:each="districtItem : ${districtMappings}"
                                                                th:text="${districtItem.value}"
                                                                th:value="${districtItem.key}"
                                                        ></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-5">
                                                <label for="buildingWard">Phường</label>
                                                <input class="form-control" id="buildingWard" name="ward" th:field="*{ward}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-md-5">
                                                <label for="buildingStreet">Đường</label>
                                                <input class="form-control" id="buildingStreet" name="street"
                                                       th:field="*{street}" type="text"/>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-4">
                                                <label for="numberOfBasement">Số tầng hầm</label>
                                                <input class="form-control" id="numberOfBasement" name="numberOfBasement"
                                                       th:field="*{numberOfBasement}" type="number"/>
                                            </div>
                                            <div class="col-sm-4">
                                                <label for="direction">Hướng</label>
                                                <input class="form-control" id="direction" name="direction" th:field="*{direction}"
                                                       type="text"/>
                                            </div>
                                            <div class="col-sm-4">
                                                <label for="level">Hạng</label>
                                                <input class="form-control" id="level" name="level" th:field="*{level}"
                                                       type="number"/>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="minRentAreaValue">Diện tích từ</label>
                                                <input class="form-control" id="minRentAreaValue" name="minRentAreaValue"
                                                       th:field="*{minRentAreaValue}" type="number"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="maxRentAreaValue">Diện tích đến</label>
                                                <input class="form-control" id="maxRentAreaValue" name="maxRentAreaValue"
                                                       th:field="*{maxRentAreaValue}" type="number"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="minRentPrice">Giá thuê từ</label>
                                                <input class="form-control" id="minRentPrice" name="minRentPrice"
                                                       th:field="*{minRentPrice}" type="number"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="maxRentPrice">Giá thuê đến</label>
                                                <input class="form-control" id="maxRentPrice" name="maxRentPrice"
                                                       th:field="*{maxRentPrice}" type="number"/>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="managerName">Tên quản lí</label>
                                                <input class="form-control" id="managerName" name="managerName"
                                                       th:field="*{managerName}" type="text"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="managerPhone">SĐT quản lí</label>
                                                <input class="form-control" id="managerPhone" name="managerPhone"
                                                       th:field="*{managerPhone}" type="text"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="staffName">Nhân viên phụ trách</label>
                                                <select class="form-control" id="staffName" name="staffId"
                                                        th:field="*{staffId}">
                                                    <option value="">---Chọn Nhân viên phụ trách---</option>
                                                    <option th:each="staff : ${staffMappings}"
                                                            th:text="${staff.value}"
                                                            th:value="${staff.key}"
                                                    ></option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <tr th:each="rentType : ${rentTypeMappings}">
                                                    <td>
                                                        <label for="rentType-${rentType.key}"
                                                               th:text="${rentType.value}"></label>
                                                        <input id="rentType-${rentType.key}" name="rentTypeCode"
                                                               th:checked="${buildingSearchDTO.rentTypeCode.contains(rentType.key)}" th:value="${rentType.key}"
                                                               type="checkbox"/>
                                                    </td>
                                                </tr>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- /.card-body -->
                                    <div class="card-footer">
                                        <button class="btn btn-primary" type="submit">Submit</button>
                                    </div>
                                </form>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </section>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <section class="content">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Building</h3>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body">
                                    <div id="jsGrid1"></div>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </section>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
        All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
            <b>Version</b> 3.2.0
        </div>
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->


<!-- jQuery -->
<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/plugins/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script th:inline="javascript">
    //<![CDATA[
    $(document).ready(function () {
        $.widget.bridge('uibutton', $.ui.button);
    });
    //]]>
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    $(function () {
        var selectedItems = [];
        $("#jsGrid1").jsGrid({
            height: "300px",
            width: "100%",
            paging: true,
            pageSize: 5,
            sorting: false,
            data: [[${buildingDTOs}]],
            selecting: true,
            selectionMode: "multiple", // Allow multiple selection
            fields: [
                {
                    type: "control",
                    title: "",
                    width: 2,
                    itemTemplate: function (value, item) {
                        var $customControls = $("<div>");

                        // Checkbox for selecting the item
                        var $selectCheckbox = $("<input>")
                            .attr("type", "checkbox")
                            .on("change", function (e) {
                                e.stopPropagation();

                                // Toggle the selected property of the clicked item
                                item.selected = $(this).is(":checked");

                                item.selected = $(this).is(":checked");

                                // If the item is selected, add it to the list; otherwise, remove it
                                if (item.selected) {
                                    selectedItems.push(item);
                                } else {
                                    selectedItems = selectedItems.filter(function (selectedItem) {
                                        return selectedItem.id !== item.id;
                                    });
                                }

                            });

                        // Set the checkbox state based on the item's selected property
                        $selectCheckbox.prop("checked", item.selected);

                        $selectCheckbox.appendTo($customControls);

                        return $customControls;
                    }
                },
                {name: "name", title: "Tên tòa nhà", type: "text", width: 20},
                {name: "address", title: "Địa chỉ", type: "text", width: 40},
                {name: "number_of_basement", title: "Số tầng hầm", type: "number", width: 5},
                {name: "manager_name", title: "Tên quản lý", type: "text", width: 20},
                {name: "manager_phone_number", title: "Số điện thoại quản lý", type: "text", width: 20},
                {name: "floor_area", title: "D.Tích sàn", type: "number", width: 20},
                {name: "rent_area", title: "D.Tích thuê", type: "number", width: 20},
                {name: "empty_area", title: "D.Tích trống", type: "number", width: 20},
                {name: "rent_price", title: "Giá thuê", type: "number", width: 20},
                {name: "service_fee", title: "Phí dịch vụ", type: "number", width: 20},
                {name: "brokerage_fee", title: "Phí môi giới", type: "number", width: 20},
                {
                    type: "control", title: "", width: 3,
                    modeSwitchButton: false,
                    editButton: true,
                    deleteButton: false,
                    itemTemplate: function (value, item) {
                        var $customControls = $("<div>");
                        var $button = $("<button>").addClass("btn btn-primary btn-sm nav-icon fas fa-edit")
                            .on("click", function (e) {
                                e.stopPropagation();
                                window.location.href = "/admin/update-building" + '?buildingId=' + item.id;
                            });
                        $button.appendTo($customControls);
                        return $customControls;
                    }
                },
                {
                    type: "control", title: "", width: 3,
                    modeSwitchButton: false,
                    editButton: true,
                    deleteButton: true,
                    itemTemplate: function (value, item) {
                        var $customControls = $("<div>");
                        var $button = $("<button>").addClass("btn btn-primary btn-sm nav-icon fas fa-trash-alt")
                            .on("click", function (e) {
                                e.stopPropagation();
                                $.ajax({
                                    url: "/admin/building/" + (selectedItems.length === 0 ? item.id : selectedItems.map(item => item.id).join(",")),
                                    method: "DELETE",
                                    success: function (response) {
                                        if (selectedItems.length === 0) {
                                            // Find the index of the item in the data array
                                            var index = $("#jsGrid1").jsGrid("option", "data").indexOf(item);

                                            // Remove the item from the data array
                                            $("#jsGrid1").jsGrid("option", "data").splice(index, 1);

                                            // Refresh the grid to reflect the changes
                                            $("#jsGrid1").jsGrid("refresh");
                                        } else {
                                            selectedItems.forEach(selectedItem => {
                                                var index = $("#jsGrid1").jsGrid("option", "data").indexOf(selectedItem);

                                                // Remove the item from the data array
                                                $("#jsGrid1").jsGrid("option", "data").splice(index, 1);

                                                // Refresh the grid to reflect the changes
                                                $("#jsGrid1").jsGrid("refresh");
                                            })
                                        }
                                        selectedItems = [];
                                    },
                                    error: function (xhr, status, error) {
                                        // Handle error response if needed
                                    }
                                });
                            });
                        $button.appendTo($customControls);
                        return $customControls;
                    }
                },
                {
                    name: "Giao tòa nhà", type: "control", title: "Giao tòa nhà", width: 3,
                    modeSwitchButton: false,
                    editButton: true,
                    itemTemplate: function (value, item) {
                        var $customControls = $("<div>");
                        var $button = $("<button>").addClass("btn btn-primary btn-sm nav-icon fas fa-building")
                            .attr("data-toggle", "modal")
                            .attr("data-target", "#modal-default")
                            .data("buildingElement", item);
                        $button.appendTo($customControls);
                        return $customControls;
                    }
                }
            ]
        });
    });
</script>
<script th:inline="javascript">
    $('#modal-default').on('show.bs.modal', function (event) {
        var modal = $(this); // Get the modal that is being shown
        var button = $(event.relatedTarget); // Button that triggered the modal
        var building = button.data('buildingElement');
        var staffIds = building.staff_manager; // Extract item data from the button
        $('.staffCheckbox').each(function () {
            var checkbox = $(this);
            var staffId = parseInt(checkbox.val());
            console.log(staffId)
            if (staffIds.includes(staffId)) {
                checkbox.prop('checked', true);
            } else {
                checkbox.prop('checked', false);
            }
        });
        $('#assignBuildingButton').click(function (event) {
            event.preventDefault(); // Prevent the default form submission behavior
            var staffElementIds = [];
            $('.staffCheckbox').each(function () {
                if ($(this).is(':checked')) {
                    staffElementIds.push($(this).val());
                }
            });

            $.ajax({
                url: '/admin/building/' + building.id + '/staff', // Pass any filter criteria to the server
                type: "POST",
                data: JSON.stringify(staffElementIds),
                contentType: 'application/json',
                success: function (response) {
                    $('#modal-default').modal('hide');
                    $("#jsGrid1").jsGrid("refresh");
                },
                error: function (xhr, status, error) {

                }
            });
        });

    });
</script>

<!-- Bootstrap 4 -->
<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<!-- ChartJS -->
<script th:src="@{/plugins/chart.js/Chart.min.js}"></script>
<!-- Sparkline -->
<script th:src="@{/plugins/sparklines/sparkline.js}"></script>
<!-- JQVMap -->
<script th:src="@{/plugins/jqvmap/jquery.vmap.min.js}"></script>
<script th:src="@{/plugins/jqvmap/maps/jquery.vmap.usa.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/plugins/jquery-knob/jquery.knob.min.js}"></script>
<!-- daterangepicker -->
<script th:src="@{/plugins/moment/moment.min.js}"></script>
<script th:src="@{/plugins/daterangepicker/daterangepicker.js}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script th:src="@{/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js}"></script>
<!-- Summernote -->
<script th:src="@{/plugins/summernote/summernote-bs4.min.js}"></script>
<!-- overlayScrollbars -->
<script th:src="@{/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/dist/js/adminlte.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/dist/js/demo.js}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script th:src="@{/dist/js/pages/dashboard.js}"></script>
<!-- jsGrid -->
<script th:src="@{/plugins/jsgrid/demos/db.js}"></script>
<script th:src="@{/plugins/jsgrid/jsgrid.min.js}"></script>
</body>
</html>
